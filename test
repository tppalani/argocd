apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: gcloud-login-pipeline
spec:
  tasks:
    - name: gcloud-auth-login
      taskRef:
        name: gcloud-auth-login-task
      params:
        - name: GCLOUD_SERVICE_KEY
          value: "$(GCLOUD_SERVICE_KEY)"
---
apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: gcloud-auth-login-task
spec:
  steps:
    - name: gcloud-auth
      image: google/cloud-sdk:latest
      command:
        - /bin/bash
      args:
        - -c
        - |
          echo "$GCLOUD_SERVICE_KEY" > /tmp/key.json && \
          gcloud auth activate-service-account --key-file=/tmp/key.json
      env:
        - name: GCLOUD_SERVICE_KEY
          value: "$(GCLOUD_SERVICE_KEY)"
  params:
    - name: GCLOUD_SERVICE_KEY
      description: "Service account key for gcloud authentication"
      type: string
----
The first part defines a Pipeline named gcloud-login-pipeline.
Inside the Pipeline, there is one Task named gcloud-auth-login, which references the Task defined later.
The Task gcloud-auth-login-task contains steps to perform gcloud auth login.
The GCLOUD_SERVICE_KEY parameter is used to pass the service account key to the Task.
To use this Pipeline:

Define a secret containing your service account key.
Replace $(GCLOUD_SERVICE_KEY) with the reference to your secret in both the Pipeline and Task.
Apply the YAML to your Tekton installation.
Trigger the PipelineRun.
Ensure that your Tekton environment has access to the necessary credentials and permissions to execute gcloud commands and manage secrets.
